<img src="https://github.com/monthly-cs/2024-01-network/assets/105256335/448ec969-da9c-4ff7-9f25-1a2af7f5f473">

**4.3.1 루프란?**

---

루프로 발생한 문제는? 대부분 브로드캐스트 스톰으로 인한 문제다.

3계층에는 TTL이라는 패킷 수명을 가지고 있지만, 스위치가 확인하는 2계층 헤더 패킷에는 TTL이 없다.

루프구조 상태에서는 문제가 유니캐스트에도 발생할 수 있다.

**4.3.2 STP**

---

이런 루프가 발생했을 때, 루프를 자동 감지해 포트를 차단하고 장애로 인한 우회로가 없을 때 차단된 포트를 스위치 스스로 풀어주는 것이 STP다.

STP는 스패닝 트리 프로토콜로, 루프를 막기 위해선 전체 스위치가 어떤식으로 연결됐는지 알아야 한다.

스위치는 BPDU라는 프로토콜을 통해 스위치 간에 정보를 전달하고 이렇게 수집된 정보를 토대로 네트워크 트리를 만들어 루프 구간을 확인한다.

스위치에 신규 장비를 붙이면 통신하는데 50초 가량 걸린다. 루프를 예방하기 위한 방어적 동작인데 새로 연결된 단말이 스위치일 가능성을 염려해 BPDU를 기다려 스위치인지 확인한다.

STP가 활성화된 경우 스위치 포트는 곧바로 포워딩 상태가 되지 않는다.
