<img src="https://github.com/monthly-cs/2024-01-network/assets/105256335/f3395769-c47e-448c-a120-81325f64eafe">

4계층에서 동작하는 장비도 네트워크 장비에 포함됐다.

4계층의 특징인 포트 번호, 시퀀스 번호, ACK 번호에 대해 이해해야 한다. 통신의 방향성이나 순서와 같은 통신 전반에 대한 관리가 필요하며 이런 정보를 세션 테이블이라는 공간에 담아 관리한다.

### 6.1 4계층 장비의 특징

---

로드밸런서나 방화벽 같은 장비를 세션 장비라고 한다.

세션 장비의 우선 고려 요소

- 세션 테이블
    
    
    세션 장비는 세션 테이블 기반으로 운용된다.
    
    세션 정보를 저장, 확인하는 작업 전반에 대한 이해가 필요하다.
    
    세션 정보는 세션 테이블에 남아 있는 라이프타임이 존재한다.
    

- Symmetric 경로 요구
    
    
    Inbound와 Outbound가 일치해야 한다.
    
- 정보 변경(LB의 경우)
    
    
    IP 주소가 변경되며 확장된 L7 로드 밸런서는 Application 프로토콜도 변경된다.
    

### 6.2 로드 밸런서

---

서버의 장비나 부하를 분산하기 위해 사용하는 장비를 로드 밸런서라고 한다.

- L4 로드 밸런싱
    
    
    일반적인 로드 밸런서가 동작하는 방식, TCP / UDP 기반으로 동작한다.
    

- L7 로드 밸런싱
    
    
    HTTP, FTP, SMTP와 같은 Application protocol 정보를 기반으로 로드 밸런싱을 수행한다. 
    
    HTTP 헤더나, URI 정보를 기반으로 부하를 분산한다.
    
    이런 장비를 ADC 라고 하며, Proxy 역할을 수행한다.(Nginx와 유사)
    

**6.2.1 L4 스위치**

L4 스위치가 동작하기 위해서는, 가상 서버 / 가상 IP / 리얼 서버 / 리얼 IP가 필요하다.

가상 서버는 사용자가 바라보는 실제 서비스이며, 가상 IP는 사용자가 접근해야 하는 IP 주소

리얼 서버는 실제 서비스를  수행하는 서버이고 리얼 IP는 실제 서버의 IP이다.

여기서 L4 스위치는 가상 IP를 리얼 IP로 변경해준다.

**6.2.2 ADC**

ADC는 다양한 동작을 위해 Proxy로 동작한다.

페일오버나 리다이렉션 기능도 지원한다.

**6.2.3 L4 스위치 vs ADC**

ADC는 성능 최적화를 위해 서버에 부하가 걸리는 작업을 별도 수행하는데

그 중 하나가 이미지나 정적 콘텐츠 캐싱이다.

ADC에서는 SSL의 엔드 포인트로 동작해 클라이언트에서 ADC 까지의 구간을 SSL로 처리해주고 ADC와 웹 서벌르 이용해 통신한다.